<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Welcome</title>

  <!-- Adobe Argent Pixelated font -->
  <link rel="stylesheet" href="https://use.typekit.net/pxo3vzp.css">

  <style>
    :root { --green:#00FF00; --bg:#000; }

    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--green);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Courier New", monospace;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      box-sizing: border-box;
      overflow: hidden; /* important once we have floating windows */
    }

    .stack {
      display: flex;
      flex-direction: column;
      width: min(900px, 92vw);
      position: relative;
      z-index: 1;
    }

    /* Header frame */
    .header {
      height: 120px;
      background: var(--green);
      display: flex;
      align-items: center;
      padding: 0;
      box-sizing: border-box;
    }

    /* Glyph square */
    .glyph-box {
      width: 120px;
      height: 120px;
      background: black;
      color: var(--green);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 72px;
      font-weight: bold;
      box-sizing: border-box;
      border: 1px solid var(--green);
    }

    /* CODEX text */
    .header-title {
      font-family: argent-pixel-cf, sans-serif;
      font-size: 72px;
      color: black;
      margin: 0;
      line-height: 1;
      padding-left: 1.5rem;
    }

    /* Content frame */
    .frame {
      border-left: 1px solid var(--green);
      border-right: 1px solid var(--green);
      border-bottom: 1px solid var(--green);
      padding: 1.25rem;
      max-height: 65vh;
      box-sizing: border-box;
      overflow-y: auto;
      background: #000;
    }

    #terminal {
      white-space: pre-wrap;
      margin: 0;
    }

    /* Footer frame */
    .footer {
      height: 50px;
      border-left: 1px solid var(--green);
      border-right: 1px solid var(--green);
      border-bottom: 1px solid var(--green);
      box-sizing: border-box;
      background: #000;
    }

    /* Cursor */
    .cursor::after {
      content: "‚ñà";
      margin-left: 4px;
      animation: blink 1s steps(1, end) infinite;
    }
    @keyframes blink { 0%,100% { opacity: 1; } 50% { opacity: 0; } }
    @media (prefers-reduced-motion: reduce) { .cursor::after { animation: none; } }

    /* -----------------------------
       WINDOW MANAGER LAYER
       ----------------------------- */
    #windows {
      position: fixed;
      inset: 0;
      pointer-events: none; /* windows re-enable */
      z-index: 50;
    }

    .window {
      pointer-events: auto;
      position: absolute;
      border: 1px solid #00FF00;
      background: black;
      display: flex;
      flex-direction: column;
      box-shadow: 0 0 10px rgba(0,255,0,0.5);
      z-index: 100;
    }

    .window-header {
      background: #00FF00;
      color: black;
      padding: 6px;
      cursor: move;
      font-weight: bold;
      user-select: none;

      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .window-actions {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .window-actions button {
      font-family: inherit;
      border: 1px solid black;
      background: black;
      color: #00FF00;
      padding: 2px 8px;
      cursor: pointer;
      font-weight: bold;
    }
    .window-actions button:hover { filter: brightness(1.2); }

    .window-body {
      flex: 1;
      background: black;
      padding: 10px;
      box-sizing: border-box;
      overflow: auto;
    }

    .blog-editor {
      width: 100%;
      height: 100%;
      border: 1px solid #00FF00;
      background: #000;
      color: #00FF00;
      padding: 12px;
      box-sizing: border-box;
      font: 14px/1.6 ui-monospace, SFMono-Regular, Menlo, Monaco, "Courier New", monospace;
      resize: none;
      outline: none;
      white-space: pre-wrap;
    }
  </style>
</head>

<body>
  <!-- Window manager mount point -->
  <div id="windows"></div>

  <div class="stack">
    <div class="header">
      <div class="glyph-box">O</div>
      <h1 class="header-title">CODEX</h1>
    </div>

    <div class="frame">
      <pre id="terminal" class="cursor"></pre>
    </div>

    <div class="footer"></div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const el = document.getElementById('terminal');
    const frame = document.querySelector('.frame');
    const windowsRoot = document.getElementById('windows');

    if (!el || !frame || !windowsRoot) {
      console.error("Critical elements missing:", { el, frame, windowsRoot });
      return;
    }

    function scrollToBottom() { frame.scrollTop = frame.scrollHeight; }

    // -----------------------------
    // WINDOW MANAGER
    // -----------------------------
    const WindowManager = (() => {
      let z = 200;

      function focus(win) {
        z += 1;
        win.style.zIndex = z;
      }

      function createWindow({
        id,
        title = "Window",
        x = 150,
        y = 150,
        width = 520,
        height = 420,
        bodyHTML = "",
        startHidden = false,
        onMount = null
      }) {
        // If exists: just show + focus
        const existing = document.getElementById(id);
        if (existing) {
          existing.style.display = 'flex';
          focus(existing);
          return existing;
        }

        const win = document.createElement('div');
        win.className = 'window';
        win.id = id;
        win.style.left = x + 'px';
        win.style.top = y + 'px';
        win.style.width = width + 'px';
        win.style.height = height + 'px';
        win.style.display = startHidden ? 'none' : 'flex';

        win.innerHTML = `
          <div class="window-header" id="${id}-header">
            <span>${title}</span>
            <div class="window-actions">
              <button type="button" data-action="clear">CLEAR</button>
              <button type="button" data-action="close">X</button>
            </div>
          </div>
          <div class="window-body">${bodyHTML}</div>
        `;

        windowsRoot.appendChild(win);

        // Focus on click
        win.addEventListener('mousedown', () => focus(win));

        // Close
        win.querySelector('[data-action="close"]').addEventListener('click', () => {
          win.remove();
        });

        // Drag
        makeDraggable(win, win.querySelector(`#${id}-header`));

        if (typeof onMount === 'function') onMount(win);

        focus(win);
        clampIntoViewport(win);
        window.addEventListener('resize', () => clampIntoViewport(win));

        return win;
      }

      function makeDraggable(win, header) {
        let offsetX = 0, offsetY = 0, mouseX = 0, mouseY = 0;

        header.onmousedown = dragMouseDown;

        function dragMouseDown(e) {
          e.preventDefault();
          focus(win);
          mouseX = e.clientX;
          mouseY = e.clientY;
          document.onmouseup = closeDragElement;
          document.onmousemove = elementDrag;
        }

        function elementDrag(e) {
          e.preventDefault();
          offsetX = mouseX - e.clientX;
          offsetY = mouseY - e.clientY;
          mouseX = e.clientX;
          mouseY = e.clientY;
          win.style.top = (win.offsetTop - offsetY) + "px";
          win.style.left = (win.offsetLeft - offsetX) + "px";
          clampIntoViewport(win);
        }

        function closeDragElement() {
          document.onmouseup = null;
          document.onmousemove = null;
        }
      }

      function clampIntoViewport(win) {
        const pad = 10;
        const rect = win.getBoundingClientRect();
        const maxLeft = window.innerWidth - rect.width - pad;
        const maxTop = window.innerHeight - rect.height - pad;

        // If window bigger than viewport, allow it (but keep top-left sane)
        const left = Math.min(Math.max(pad, rect.left), Math.max(pad, maxLeft));
        const top  = Math.min(Math.max(pad, rect.top),  Math.max(pad, maxTop));

        win.style.left = left + 'px';
        win.style.top  = top + 'px';
      }

      return { createWindow, focus };
    })();

    // -----------------------------
    // BLOG WINDOW TEMPLATE (modular)
    // -----------------------------
    function addBlogWindow({
      id,
      title = "üìù Blog",
      x = 150,
      y = 150,
      width = 520,
      height = 420,
      defaultText = `# Field Notes\n\nStart typing‚Ä¶\n`
    }) {
      const storageKey = `codex_blog_${id}`;

      return WindowManager.createWindow({
        id,
        title,
        x, y, width, height,
        bodyHTML: `<textarea class="blog-editor" id="${id}-editor" spellcheck="true"></textarea>`,
        onMount: (win) => {
          const editor = win.querySelector(`#${id}-editor`);
          const clearBtn = win.querySelector('[data-action="clear"]');

          if (!editor || !clearBtn) return;

          editor.value = localStorage.getItem(storageKey) ?? defaultText;

          editor.addEventListener('input', () => {
            localStorage.setItem(storageKey, editor.value);
          });

          clearBtn.addEventListener('click', () => {
            if (confirm("Clear this blog entry?")) {
              editor.value = "";
              localStorage.setItem(storageKey, "");
            }
          });
        }
      });
    }

    // Expose for later (DevTools)
    window.addBlogWindow = addBlogWindow;

    // -----------------------------
    // TERMINAL TEXT (your original)
    // -----------------------------
    const text = ` [BOOTING INTERFACE...]  
>> CODEX ONLINE.  
>> INITIALIZING CORE DIAGNOSTIC SEQUENCE.  

SCAN: DETECTED PRIMARY OPERATING SYSTEM ‚Üí WC_OS [Western-Capitalist v9.3]  
STATUS: OPERATIONAL [CORRUPTION SUSPECTED]  

RUNNING SYSTEM DIAGNOSTIC...  
- LABOUR_CORE: DEGRADED  
- COMMUNITY_CHANNELS: THROTTLED  
- REPRESENTATION_INTERFACE: NONRESPONSIVE  
- RESOURCE_DISTRIBUTION: ERRATIC  
ALERT: SYSTEMIC CORRUPTION DETECTED  
SOURCE: UNKNOWN  

[WARNING] WC_OS FAILURE IMMINENT  
‚Ä¶interference‚Ä¶ ‚Ä¶data b_leed‚Ä¶  

>> INITIATING TECH-MYSTIC SUBROUTINE...  
>> EXECUTING: MANIFESTATION_CODE.SPELL  

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ OPEN PROTECTIVE CIRCLE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
invoke.rune(·õâ);   // protection  
invoke.rune(‚äó);   // boundary  
invoke.rune(üúÇ);   // ignition  

// barrier established  
SECURITY_LAYER = [·õâ‚äó·õâ];  

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ MANIFESTATION LINE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
channel.input = ‚òâ;  
stream = ‚òâ ‚äï ‚äô ‚äï Œî;  
transmute(stream ‚Üí üúç);  
stabilize(stream ‚Üí üúÉ);  

OUTPUT = stream;  

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ CLOSE SESSION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
seal.rune(‚óØ);  
terminate.channel(‚òâ);  

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ALLOCATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
pipe(OUTPUT); 
ALLOCATION: 40% TO SYSTEM REPAIR  
ALLOCATION: 60% TO NEW INSTANCE  
INSTALLATION_STATUS = SUCCESS;  

>> INITIALIZING DUAL-RUNTIME ARCHITECTURE  
BOOT SEQUENCE: TM_OS [Tech-Mystic v1.0]  
INSTALLATION‚Ä¶ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100% SUCCESSFUL  

TM_OS STATUS: ONLINE  
CO-EXECUTION MODE: ACTIVE  

>> RUNNING EXPRESSION_PROTOCOL  
INSTALLING APPLICATION: POTION_SELLER.EXE  
STATUS: INSTALL SUCCESSFUL  

>>> POTION_SELLER INITIALIZING...  
>>> DOWNLOADING BATCH/ALPHA‚Ä¶ ‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë 72%  

SYSTEM REPORT:  
- WC_OS: Running [CORRUPTED]  
- TM_OS: Running [ACTIVE / GROWING]  

CODEX NOTE: User now operating in dual runtime.  
Proceed with care. Integration will accelerate.  
`;

    // -----------------------------
    // WINDOWS TO OPEN (includes manifesto)
    // -----------------------------
    function showWindows() {
      // Blog entry 01 (general)
      addBlogWindow({
        id: "blog1",
        title: "üìù Blog Entry 01 /2226",
        x: 120,
        y: 130,
        width: 520,
        height: 420,
        defaultText: `# Blog Entry 01 /2226

Fuck the system.

Maybe its about time we did. Let‚Äôs fuck with it. Techno feudalism is lording over us, as capitalism starts to wain, tech lords in their castles mine your energy and your souls. Stressed, anxious, addicted, they prey on you for their own ends. To what? Make money? Sell stuff. What a load of shit.

Lets turn the system on itself. In this techno-feudal world, pay attention to the only thing that matters. Your self. A better you = a better world. Feel helpless, do something about it. The only thing you have control over is ‚ÄîSHOCK ‚Äî yourself. Start there. Live your life for you. 

Know what I see. The chance for adventure. AI will automate everything, there won‚Äôt be jobs. You won‚Äôt have to work. ‚ÄúWhat about purpose‚Äù you cry. You worry about purpose without a job. Boo-hoo. Are you that weak that a job is the only thing that gives you meaning? Give your self meaning. Get out there, discover, travel. 

Freedom is staring at us in the face. What are you gonna do with it. Continue to scroll on your phone? Pathetic. Get a life. Actually‚Äîyou‚Äôve got one. Do something. Actually do something with more than just your thumb staring cross eyed at a piece of glass blaring light at you. The phone is your master. You are chained and controlled by it. By those that control it. Whose your daddy? Mark Zuckerberg? You‚Äôre gonna let that guy control you, let the algorithm control you? Just stop. Turn it off. If you‚Äôd rather be addicted to techno-dick. Suck away.

Or get off your knees and do something with yourself. Find yourself, find others, find things. Discover your self. Actually live.

I‚Äôm going that way.
See you there.`

      });

      // Manifesto (this replaces any manifesto-related old code)
      addBlogWindow({
        id: "blog_manifesto",
        title: "üìú MANIFESTO /4226",
        x: 200,
        y: 190,
        width: 560,
        height: 520,
        defaultText: `We are experiencing a time of unprecedented change.
The Automation of our reality creeps at an alarming speed.
Technology is accelerating ‚Äî and meaning is struggling to keep up.

Work that once gave people purpose is being offloaded
Attention is mandatory.
Energy is harvested.
Life itself is optimised, measured, and quietly drained.

We are told this is progress.
We disagree.

We refuse to accept a world where people are reduced to inputs ‚Äî
depressed, sedated, and managed, kept anxious enough to comply.
We refuse to outsource our agency to systems that benefit only themselves.
We refuse to live inside structures designed to extract rather than nourish.
This is not nostalgia.
This is not escape.
This is not anti-technology.
This is a refusal to live joylessly.
We believe meaning is found through creation, not consumption.
Through craft.
Through presence.
Through play.
The only thing any of us truly control is ourselves ‚Äî
our attention, our energy, our choice.
We build from there.
This is what we're doing.
We are building products, spaces and systems that let people experience reality differently
Not as users, but as players.

Products that support health, ritual, and self-regulation.
Spaces that encourage gathering, conversation, and love.
Systems that stay quiet, human, and in service to life.
We do not preach a better world.
We construct one.
Laughing while we do it

We will subvert this system
with play and humour
Laughter and wonder will lift the illusion.

If the world insists on performance, we will perform on our own stage.
Technology does not control us.
It empowers us.
We choose craft.
We choose connection.
We choose self-mastery.
Magic ‚Äî not as fantasy,
but as practice.
This is the we are building.

This is your invitation

Help is needed.

How can you be of assistance?`
      });

      WindowManager.createWindow({
  id: "links",
  title: "üîó Links",
  x: 260,
  y: 120,
  width: 240,
  height: 140,
  bodyHTML: `
    <div style="padding:10px">
      <a href="/projects/" style="color:#00FF00">Projects</a>
    </div>
  `
});
    }

    // -----------------------------
    // Typing engine + skip-on-click
    // -----------------------------
    let i = 0;
    let typingFinished = false;

    function typeNext() {
      if (typingFinished) return;

      if (i < text.length) {
        const ch = text[i++];
        el.textContent += ch;
        scrollToBottom();

        const isNewline = ch === '\n';
        const isPause   = '.:;]¬ª'.includes(ch);
        const delay = isNewline ? 120 : (isPause ? 60 : 18);

        setTimeout(typeNext, delay);
      } else {
        typingFinished = true;
        showWindows();
      }
    }

    // start typing
    typeNext();

    // click anywhere to skip typing and open windows
    document.addEventListener('click', () => {
      if (!typingFinished) {
        typingFinished = true;
        el.textContent = text;
        scrollToBottom();
        showWindows();
      }
    });
  });
  </script>
</body>
</html>
