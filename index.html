<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>House of Mouth</title>
  <link rel="stylesheet" href="https://use.typekit.net/pxo3vzp.css">
  <style>
    :root { --green:#00FF00; --bg:#000; }

    html, body { height:100%; }
    body{
      margin:0; background:var(--bg); color:var(--green);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Courier New", monospace;
      overflow:hidden;
    }

    /* Editable code background */
    .bg-toolbar{
      position:fixed; top:10px; left:10px; z-index:10000;
      display:flex; gap:8px; align-items:center;
      border:1px solid var(--green); background:#000;
      padding:6px 8px;
    }
    .bg-toolbar button{
      font:inherit; border:1px solid var(--green); background:#000; color:var(--green);
      padding:4px 10px; cursor:pointer; font-weight:bold;
    }
    .bg-toolbar span{ opacity:.85; font-size:12px; }

    #bg{
      position:fixed; inset:0; padding:60px 18px 18px;
      white-space:pre-wrap; overflow:auto;
      color:var(--green); opacity:.35;
      outline:none;
      pointer-events:none; /* locked by default */
    }
    body.editing #bg{ pointer-events:auto; opacity:.8; }

    /* Window manager layer */
    #windows{ position:fixed; inset:0; z-index:50; pointer-events:none; }
    .window{
      pointer-events:auto;
      position:absolute;
      display:flex;
      flex-direction:column;
      border:1px solid var(--green);
      background:#000;
      box-shadow:0 0 12px rgba(0,255,0,.35);
      resize: both;
      overflow: auto;
      min-width: 220px;
      min-height: 120px;
      max-width: 98vw;
      max-height: 90vh;
    }
    .window-header{
      background:var(--green); color:#000;
      padding:6px; font-weight:bold; cursor:move; user-select:none;
      display:flex; justify-content:space-between; gap:10px; align-items:center;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    #minibar {
      position: fixed;
      left: 0; right: 0; bottom: 0;
      height: 38px;
      background: #111;
      border-top: 1px solid var(--green);
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 0 12px;
      z-index: 10001;
    }
    .minibar-btn {
      background: var(--green);
      color: #000;
      border: 1px solid #000;
      border-radius: 4px 4px 0 0;
      padding: 4px 12px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 4px;
      font-size: 15px;
    }
    .window-actions{ display:flex; gap:8px; }
    .window-actions button{
      font:inherit; border:1px solid #000; background:#000; color:var(--green);
      padding:2px 8px; cursor:pointer; font-weight:bold;
    }
    .window-body{ flex:1; overflow:hidden; }
    .window-body iframe{ width:100%; height:100%; border:0; background:#000; }
      .resize-handle {
        position: absolute;
        right: 0;
        bottom: 0;
        width: 18px;
        height: 18px;
        background: var(--green);
        cursor: se-resize;
        z-index: 10;
        border-top: 1px solid #000;
        border-left: 1px solid #000;
        opacity: 0.7;
      }
  </style>
</head>
<body>

  <div class="bg-toolbar">
    <button id="toggleEdit">EDIT BG</button>
    <button id="newWin">NEW WINDOW</button>
    <span id="status">locked</span>
  </div>

  <div id="bg" contenteditable="true" spellcheck="false"></div>
  <div id="windows"></div>
  <div id="minibar"></div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const windowsRoot = document.getElementById('windows');
    const bg = document.getElementById('bg');
    const toggleEdit = document.getElementById('toggleEdit');
    const status = document.getElementById('status');
    const newWinBtn = document.getElementById('newWin');

    // ---------- Background text (editable + saved) ----------
    const BG_KEY = "hom_desktop_bg_v1";
    bg.textContent = localStorage.getItem(BG_KEY) ?? `// HOUSE OF MOUTH DESKTOP
// Click NEW WINDOW to load a page.
// Toggle EDIT BG to change this background text.

routes = {
  TM-OS: "/TM-OS/",
  projects: "/projects/",
};

boot();`;

    bg.addEventListener('input', () => localStorage.setItem(BG_KEY, bg.textContent));

    function setEditing(on){
      document.body.classList.toggle('editing', !!on);
      status.textContent = on ? 'editing' : 'locked';
    }
    setEditing(false);

    toggleEdit.addEventListener('click', () => setEditing(!document.body.classList.contains('editing')));

    // ---------- Window Manager ----------
    let z = 100;

    function focus(win){ win.style.zIndex = ++z; }

    function createWindow({ id, title, x, y, w, h, url }){
      const existing = document.getElementById(id);
      if(existing){ existing.style.display = 'flex'; focus(existing); return existing; }

      const win = document.createElement('div');
      win.className = 'window';
      win.id = id;
      win.style.left = x + 'px';
      win.style.top = y + 'px';
      win.style.width = w + 'px';
      win.style.height = h + 'px';

      win.innerHTML = `
        <div class="window-header" id="${id}-header">
          <span>${title}</span>
          <div class="window-actions">
            <button type="button" data-minimize>_</button>
            <button type="button" data-reload>R</button>
            <button type="button" data-close>X</button>
          </div>
        </div>
        <div class="window-body" style="position:relative;flex:1;">
          <div class="window-focus-overlay" style="position:absolute;left:0;top:0;right:20px;bottom:20px;z-index:5;cursor:pointer;"></div>
          <iframe src="${url}" title="${title}" style="position:relative;z-index:1;width:100%;height:100%;"></iframe>
        </div>
      `;
      // Minimize logic
      const minibar = document.getElementById('minibar');
      const minimizeBtn = win.querySelector('[data-minimize]');
      minimizeBtn.addEventListener('click', () => {
        win.style.display = 'none';
        let btn = document.createElement('button');
        btn.className = 'minibar-btn';
        btn.textContent = title;
        btn.onclick = () => {
          win.style.display = 'flex';
          focus(win);
          btn.remove();
        };
        minibar.appendChild(btn);
      });

      windowsRoot.appendChild(win);
      focus(win);

      // Focus window when clicking anywhere on the window except controls or iframe
      // Overlay click focuses window, but ignore if clicking controls or resize
      const overlay = win.querySelector('.window-focus-overlay');
      overlay.addEventListener('mousedown', (e) => {
        // Don't focus if clicking on action buttons or resize handle
        if (!e.target.closest('.window-actions button') && !e.target.classList.contains('resize-handle')) {
          focus(win);
        }
      });

      win.querySelector('[data-close]').addEventListener('click', () => win.remove());
      win.querySelector('[data-reload]').addEventListener('click', () => {
        const iframe = win.querySelector('iframe');
        iframe.src = iframe.src;
      });

      makeDraggable(win, win.querySelector(`#${id}-header`));
      clamp(win);


      window.addEventListener('resize', () => clamp(win));
      return win;
    }

    function makeDraggable(win, header){
      let startX=0, startY=0, lastX=0, lastY=0;

      header.addEventListener('mousedown', (e) => {
        e.preventDefault();
        focus(win);
        startX = e.clientX;
        startY = e.clientY;
        lastX = win.offsetLeft;
        lastY = win.offsetTop;
        // Prevent text selection while dragging
        document.body.style.userSelect = 'none';
        document.body.style.webkitUserSelect = 'none';
        document.body.style.mozUserSelect = 'none';
        document.body.style.msUserSelect = 'none';

        const onMove = (ev) => {
          const dx = ev.clientX - startX;
          const dy = ev.clientY - startY;
          win.style.left = (lastX + dx) + 'px';
          win.style.top = (lastY + dy) + 'px';
          clamp(win);
        };

        const onUp = () => {
          document.removeEventListener('mousemove', onMove);
          document.removeEventListener('mouseup', onUp);
          // Restore text selection
          document.body.style.userSelect = '';
          document.body.style.webkitUserSelect = '';
          document.body.style.mozUserSelect = '';
          document.body.style.msUserSelect = '';
        };

        document.addEventListener('mousemove', onMove);
        document.addEventListener('mouseup', onUp);
      });
    }

    function clamp(win){
      const pad = 10;
      const rect = win.getBoundingClientRect();
      const maxLeft = window.innerWidth - rect.width - pad;
      const maxTop = window.innerHeight - rect.height - pad;

      const left = Math.min(Math.max(pad, rect.left), Math.max(pad, maxLeft));
      const top  = Math.min(Math.max(pad, rect.top),  Math.max(pad, maxTop));

      win.style.left = left + 'px';
      win.style.top = top + 'px';
    }

    // ---------- Default windows ----------
    createWindow({
      id: "win_TM-OS",
      title: "TM-OS",
      x: 80, y: 80, w: 760, h: 520,
      url: "/TM-OS/"
    });

    createWindow({
      id: "win_projects",
      title: "PROJECTS",
      x: 140, y: 140, w: 620, h: 420,
      url: "/projects/"
    });

    createWindow({
  id: "win_manifesto",
  title: "ðŸ“œ MANIFESTO /4226",
  x: 180,
  y: 180,
  w: 640,
  h: 520,
  url: "/manifesto/"
});

  createWindow({
  id: "win_blog",
  title: "ðŸ“œ Blog Entry 01/2226",
  x: 180,
  y: 180,
  w: 640,
  h: 520,
  url: "/blog/"
});

    // Duplicate TM-OS window as a static Potion Seller window (yellow accents, no animation)
    createWindow({
      id: "win_PotionSeller",
      title: "Potion Seller",
      x: 220,
      y: 160,
      w: 700,
      h: 520,
      url: "/potion-seller/"
    });

    // Apply accent overrides for the Potion Seller window (yellow)
    const _ps = document.getElementById('win_PotionSeller');
    if (_ps) {
      _ps.style.border = '1px solid #ffff00';
      _ps.style.boxShadow = '0 0 12px rgba(255,255,0,0.35)';
      const hdr = _ps.querySelector('.window-header');
      if (hdr) {
        hdr.style.background = '#ffff00';
        hdr.style.color = '#000';
      }
      const iframe = _ps.querySelector('.window-body iframe');
      if (iframe) iframe.style.background = '#fff';
    }

    // ---------- Add new window button ----------
    newWinBtn.addEventListener('click', () => {
      const url = prompt("Enter a URL or route (e.g. /projects/ or /TM-OS/):", "/projects/");
      if(!url) return;
      const safeId = "win_" + Math.random().toString(16).slice(2);
      createWindow({ id: safeId, title: url, x: 120, y: 120, w: 640, h: 420, url });
    });
  });
  </script>
</body>
</html>
