<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>House of Mouth</title>
  <link rel="stylesheet" href="https://use.typekit.net/pxo3vzp.css">
  <style>
:root { --green:#00FF00; --bg:#000; }

html, body {
  height:100%;
  margin:0;
  background:var(--bg);
  color:var(--green);
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Courier New", monospace;
  overflow:hidden;
}

/* ===== OUTER DESKTOP FRAME (WHITE) ===== */
#desktop-frame{
  position:fixed;
  inset:0;
  border:1px solid #fff;
  box-sizing:border-box;
  background:#000;
  display:flex;
  flex-direction:column;
}

#desktop-header{
  height:30px;
  background:#fff;
  color:#000;
  display:flex;
  align-items:center;
  justify-content:center;
  font-family:"itc-benguiat-condensed", serif;
  font-weight:700;
  font-size:18px;
  letter-spacing:0px;
  flex-shrink:0;
  user-select:none;
}

#desktop-content{
  flex:1;
  position:relative;
  overflow:hidden;
  background:#000;
}

/* ===== BACKGROUND TEXT ===== */
#bg{
  position:absolute;
  inset:0;
  padding:18px;
  white-space:pre-wrap;
  overflow:auto;
  color:var(--green);
  opacity:.35;
  outline:none;
  pointer-events:none;
}
body.editing #bg{
  pointer-events:auto;
  opacity:.8;
}

    /* ===== WINDOW MANAGER LAYER ===== */
    #windows{
      position:absolute;
      inset:0;
      z-index:50;
      pointer-events:none;
    }

.window{
  pointer-events:auto;
  position:absolute;
  display:flex;
  flex-direction:column;
  border:1px solid var(--green);
  background:#000;
  box-shadow:0 0 12px rgba(0,255,0,.35);
  resize:both;
  overflow:hidden;
  min-width:220px;
  min-height:120px;
  max-width:98vw;
  max-height:90vh;
}

.window-header{
  background:var(--green);
  color:#000;
  padding:6px;
  font-weight:bold;
  cursor:move;
  display:flex;
  justify-content:space-between;
  gap:10px;
  align-items:center;
  text-transform:uppercase;
  user-select:none;
}

.window-actions{
  display:flex;
  gap:8px;
}

.window-actions button{
  font:inherit;
  border:1px solid #000;
  background:#000;
  color:var(--green);
  padding:2px 8px;
  cursor:pointer;
  font-weight:bold;
}

.window-body{
  flex:1;
  overflow:hidden;
  min-height:0;
}

.window-body iframe{
  width:100%;
  height:100%;
  border:0;
}

/* ===== MINIBAR â€” SINGLE-LINE VERTICAL SCROLL (ALL DEVICES) ===== */
#minibar{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  bottom:10px;

  width:min(720px, calc(100% - 24px));
  height:84px;                 /* ~1 button visible */
  padding:10px;
  box-sizing:border-box;

  background: rgba(0,0,0,.92);
  border:1px solid var(--green);
  border-radius:12px;
  z-index:10001;

  display:flex;
  flex-direction:column;
  gap:10px;
  align-items:stretch;

  overflow-y:auto;             /* vertical scroll */
  overflow-x:hidden;
  -webkit-overflow-scrolling:touch;

  scroll-snap-type:y mandatory;

  /* keeps the padding consistent after scrolling/snapping */
  scroll-padding-top: 10px;
  scroll-padding-bottom: 10px;
  scroll-padding-block: 10px;
}

.minibar-btn{
  width:100%;
  height:54px;
  margin:0;

  background:var(--green);
  color:#000;
  border:1px solid #000;
  border-radius:10px;
  padding:10px 12px;

  font-weight:bold;
  font-size:16px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Courier New", monospace;
  text-transform: uppercase;
  white-space: nowrap;

  scroll-snap-align:start;
  flex: 0 0 auto;
}
</style>
</head>

<body>
  <div id="desktop-frame">
    <div id="desktop-header">HoM</div>

    <div id="desktop-content">
      <div id="bg" contenteditable="true" spellcheck="false"></div>
      <div id="windows"></div>
      <div id="minibar"></div>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const windowsRoot = document.getElementById('windows');

    // ---------- Window Manager ----------
    let z = 100;
    function focus(win){ win.style.zIndex = ++z; }

    function createWindow({ id, title, x, y, w, h, url }){
      const existing = document.getElementById(id);
      if(existing){ existing.style.display = 'flex'; focus(existing); return existing; }

      const win = document.createElement('div');
      win.className = 'window';
      win.id = id;
      win.style.left = x + 'px';
      win.style.top = y + 'px';
      win.style.width = w + 'px';
      win.style.height = h + 'px';

      win.innerHTML = `
        <div class="window-header" id="${id}-header">
          <span>${title}</span>
          <div class="window-actions">
            <button type="button" data-minimize>_</button>
            <button type="button" data-reload>R</button>
            <button type="button" data-close>X</button>
          </div>
        </div>
        <div class="window-body" style="flex:1;">
          <iframe src="${url}" title="${title}" style="width:100%;height:100%;border:0;"></iframe>
        </div>
      `;

      // Minimize logic
      const minibar = document.getElementById('minibar');
      const minimizeBtn = win.querySelector('[data-minimize]');
      minimizeBtn.addEventListener('click', () => {
        win.style.display = 'none';
        let btn = document.createElement('button');
        btn.className = 'minibar-btn';
        btn.textContent = title;
        btn.onclick = () => {
          win.style.display = 'flex';
          focus(win);
          btn.remove();
        };
        minibar.appendChild(btn);
      });

      windowsRoot.appendChild(win);
      focus(win);

      // Focus window on any mousedown within the window (capture phase), except action buttons
      win.addEventListener('mousedown', (e) => {
        if (!e.target.closest('.window-actions button')) focus(win);
      }, true);

      win.querySelector('[data-close]').addEventListener('click', () => win.remove());
      win.querySelector('[data-reload]').addEventListener('click', () => {
        const iframe = win.querySelector('iframe');
        iframe.src = iframe.src;
      });

      makeDraggable(win, win.querySelector(`#${id}-header`));
      clamp(win);

      window.addEventListener('resize', () => clamp(win));
      return win;
    }

    function makeDraggable(win, header){
      let startX=0, startY=0, lastX=0, lastY=0;

      header.addEventListener('mousedown', (e) => {
        e.preventDefault();
        focus(win);
        startX = e.clientX;
        startY = e.clientY;
        lastX = win.offsetLeft;
        lastY = win.offsetTop;

        document.body.style.userSelect = 'none';
        document.body.style.webkitUserSelect = 'none';
        document.body.style.mozUserSelect = 'none';
        document.body.style.msUserSelect = 'none';

        const onMove = (ev) => {
          const dx = ev.clientX - startX;
          const dy = ev.clientY - startY;
          win.style.left = (lastX + dx) + 'px';
          win.style.top = (lastY + dy) + 'px';
          clamp(win);
        };

        const onUp = () => {
          document.removeEventListener('mousemove', onMove);
          document.removeEventListener('mouseup', onUp);
          document.body.style.userSelect = '';
          document.body.style.webkitUserSelect = '';
          document.body.style.mozUserSelect = '';
          document.body.style.msUserSelect = '';
        };

        document.addEventListener('mousemove', onMove);
        document.addEventListener('mouseup', onUp);
      });
    }

    function clamp(win){
      const pad = 10;
      const rect = win.getBoundingClientRect();
      const maxLeft = window.innerWidth - rect.width - pad;
      const maxTop = window.innerHeight - rect.height - pad;

      const left = Math.min(Math.max(pad, rect.left), Math.max(pad, maxLeft));
      const top  = Math.min(Math.max(pad, rect.top),  Math.max(pad, maxTop));

      win.style.left = left + 'px';
      win.style.top = top + 'px';
    }

    // ---------- Default windows ----------
    const windowsToCreate = [
      { id: "win_TM-OS", title: "TM-OS", x: 80, y: 80, w: 760, h: 520, url: "/TM-OS/", minimize: false },
      { id: "win_projects", title: "PROJECTS", x: 140, y: 140, w: 620, h: 420, url: "/projects/", minimize: true },
      { id: "win_manifesto", title: "ðŸ“œ MANIFESTO /4226", x: 180, y: 180, w: 640, h: 520, url: "/manifesto/", minimize: true },
      { id: "win_blog", title: "ðŸ“œ Blog Entry 01/2226", x: 180, y: 180, w: 640, h: 520, url: "/blog/", minimize: true },
      { id: "win_PotionSeller", title: "Potion Seller", x: 220, y: 160, w: 700, h: 520, url: "/potion-seller/", minimize: true }
    ];

    const windowRefs = {};
    windowsToCreate.forEach(win => {
      const ref = createWindow(win);
      windowRefs[win.id] = ref;
      if (win.minimize && ref) {
        const minBtn = ref.querySelector('[data-minimize]');
        if (minBtn) minBtn.click();
      }
    });

    // Apply accent overrides for the Potion Seller window (yellow)
    function stylePotionSeller() {
      const _ps = document.getElementById('win_PotionSeller');
      if (_ps) {
        _ps.style.border = '1px solid #ffff00';
        _ps.style.boxShadow = '0 0 12px rgba(255,255,0,0.35)';
        const hdr = _ps.querySelector('.window-header');
        if (hdr) {
          hdr.style.background = '#ffff00';
          hdr.style.color = '#000';
        }
        const iframe = _ps.querySelector('.window-body iframe');
        if (iframe) iframe.style.background = '#fff';
      }
    }
    stylePotionSeller();

    function showPotionSellerWindow() {
      const minibar = document.getElementById('minibar');
      const btns = minibar.querySelectorAll('.minibar-btn');
      for (const btn of btns) {
        if (btn.textContent === 'Potion Seller') {
          btn.click();
          break;
        }
      }
      stylePotionSeller();
    }

    window.addEventListener('message', (event) => {
      if (event.data === 'TMOS_ANIMATION_DONE') {
        showPotionSellerWindow();
      }
    });

    // (New window button removed / not in use)
  });
  </script>
</body>
</html>
