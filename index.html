<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Welcome</title>
  <!-- Adobe Argent Pixelated font -->
  <link rel="stylesheet" href="https://use.typekit.net/pxo3vzp.css">

  <style>
    :root { --green:#00FF00; --bg:#000; }

    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--green);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Courier New", monospace;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      box-sizing: border-box;
    }

    .stack {
      display: flex;
      flex-direction: column;
      width: min(900px, 92vw);
    }
    .window {
      position: absolute;
      top: 150px;
      left: 150px;
      width: 500px;
      height: 400px;
      border: 1px solid #00FF00;
      background: black;
      display: flex;
      flex-direction: column;
      box-shadow: 0 0 10px rgba(0,255,0,0.5);
      z-index: 10;
    }
    
    .window-header {
      background: #00FF00;
      color: black;
      padding: 6px;
      cursor: move;
      font-weight: bold;
      user-select: none;
    }
    
    .window-body {
      flex: 1;
      background: black;
    }
    
    .window-body iframe {
      width: 100%;
      height: 100%;
    }

    /* Header frame */
    .header {
      height: 120px;
      background: var(--green);   /* filled green */
      display: flex;
      align-items: center;
      padding: 0;
      box-sizing: border-box;
    }

    /* Glyph square */
    .glyph-box {
      width: 120px;
      height: 120px;
      background: black;         /* solid black square */
      color: var(--green);       /* glyph is green */
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 72px;
      font-weight: bold;
      box-sizing: border-box;
      border: 1px solid var(--green); /* pixel border */
}


    /* CODEX text */
    .header-title {
      font-family: argent-pixel-cf, sans-serif; /* Adobe font */
      font-size: 72px;
      color: black;
      margin: 0;
      line-height: 1;
      padding-left: 1.5rem; /* spacing between glyph and text */
    }

    /* Content frame */
    .frame {
      border-left: 1px solid var(--green);
      border-right: 1px solid var(--green);
      border-bottom: 1px solid var(--green);
      padding: 1.25rem;
      max-height: 65vh;
      box-sizing: border-box;
      overflow-y: auto;
    }

    #terminal {
      white-space: pre-wrap;
      margin: 0;
    }

    /* Footer frame */
    .footer {
      height: 50px;
      border-left: 1px solid var(--green);
      border-right: 1px solid var(--green);
      border-bottom: 1px solid var(--green);
      box-sizing: border-box;
    }

    /* Cursor */
    .cursor::after {
      content: "‚ñà";
      margin-left: 4px;
      animation: blink 1s steps(1, end) infinite;
    }
    @keyframes blink { 0%,100% { opacity: 1; } 50% { opacity: 0; } }
    @media (prefers-reduced-motion: reduce) { .cursor::after { animation: none; } }

    /* Window manager layer */
#windows {
  position: fixed;
  inset: 0;
  pointer-events: none; /* windows themselves re-enable */
  z-index: 50;
}

.window {
  pointer-events: auto;
}

.window-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
}

.window-actions button {
  font-family: inherit;
  border: 1px solid black;
  background: black;
  color: #00FF00;
  padding: 2px 8px;
  cursor: pointer;
  font-weight: bold;
}

.window-actions button:hover { filter: brightness(1.2); }

/* Blog editor */
.blog-editor {
  width: 100%;
  height: 100%;
  border: 1px solid #00FF00;
  background: #000;
  color: #00FF00;
  padding: 12px;
  box-sizing: border-box;
  font: 14px/1.6 ui-monospace, SFMono-Regular, Menlo, Monaco, "Courier New", monospace;
  resize: none;
  outline: none;
  white-space: pre-wrap;
}

  </style>
</head>
<body>
  <!-- Window manager container -->
<div id="windows"></div>
  
  <div class="stack">
    <!-- Header with glyph + text -->
    <div class="header">
      <div class="glyph-box">O</div>
      <h1 class="header-title">CODEX</h1>
    </div>

    <!-- Terminal frame -->
    <div class="frame">
      <pre id="terminal" class="cursor"></pre>
    </div>

    <!-- Footer -->
    <div class="footer"></div>
  </div>

  <script>
  const el = document.getElementById('terminal');
  const frame = document.querySelector('.frame');
  const windowsRoot = document.getElementById('windows');

  function scrollToBottom() { frame.scrollTop = frame.scrollHeight; }

  // -----------------------------
  // WINDOW MANAGER (modular)
  // -----------------------------
  const WindowManager = (() => {
    let z = 100; // stacking order

    function createWindow({
      id,
      title = "Window",
      x = 150,
      y = 150,
      width = 520,
      height = 420,
      bodyHTML = "",
      onMount = null, // hook after DOM created
      startHidden = false
    }) {
      // If same id exists, bring to front and return it
      const existing = document.getElementById(id);
      if (existing) {
        focus(existing);
        existing.style.display = 'flex';
        return existing;
      }

      const win = document.createElement('div');
      win.className = 'window';
      win.id = id;
      win.style.position = 'absolute';
      win.style.top = y + 'px';
      win.style.left = x + 'px';
      win.style.width = width + 'px';
      win.style.height = height + 'px';
      win.style.display = startHidden ? 'none' : 'flex';

      win.innerHTML = `
        <div class="window-header" id="${id}-header">
          <span>${title}</span>
          <div class="window-actions">
            <button type="button" data-action="clear">CLEAR</button>
            <button type="button" data-action="close">X</button>
          </div>
        </div>
        <div class="window-body">${bodyHTML}</div>
      `;

      windowsRoot.appendChild(win);

      // Bring to front on interaction
      win.addEventListener('mousedown', () => focus(win));

      // Draggable
      makeDraggable(win, win.querySelector(`#${id}-header`));

      // Close button
      win.querySelector('[data-action="close"]').addEventListener('click', () => {
        win.remove();
      });

      // Optional mount hook (attach editor logic etc.)
      if (typeof onMount === 'function') onMount(win);

      // default focus
      focus(win);

      return win;
    }

    function focus(win) {
      z += 1;
      win.style.zIndex = z;
    }

    function makeDraggable(win, header) {
      let offsetX = 0, offsetY = 0, mouseX = 0, mouseY = 0;

      header.onmousedown = dragMouseDown;

      function dragMouseDown(e) {
        e.preventDefault();
        mouseX = e.clientX;
        mouseY = e.clientY;
        document.onmouseup = closeDragElement;
        document.onmousemove = elementDrag;
      }

      function elementDrag(e) {
        e.preventDefault();
        offsetX = mouseX - e.clientX;
        offsetY = mouseY - e.clientY;
        mouseX = e.clientX;
        mouseY = e.clientY;
        win.style.top = (win.offsetTop - offsetY) + "px";
        win.style.left = (win.offsetLeft - offsetX) + "px";
      }

      function closeDragElement() {
        document.onmouseup = null;
        document.onmousemove = null;
      }
    }

    return { createWindow, focus };
  })();

  // -----------------------------
  // BLOG WINDOW TEMPLATE
  // -----------------------------
  function addBlogWindow({
    id,
    title = "üìù Blog",
    x = 150,
    y = 150,
    width = 520,
    height = 420,
    defaultText = `# Field Notes\n\nStart typing‚Ä¶\n`,
  }) {
    const storageKey = `codex_blog_${id}`;

    return WindowManager.createWindow({
      id,
      title,
      x, y, width, height,
      bodyHTML: `<textarea class="blog-editor" id="${id}-editor" spellcheck="true"></textarea>`,
      onMount: (win) => {
        const editor = win.querySelector(`#${id}-editor`);
        const clearBtn = win.querySelector('[data-action="clear"]');

        // load
        editor.value = localStorage.getItem(storageKey) ?? defaultText;

        // save
        editor.addEventListener('input', () => {
          localStorage.setItem(storageKey, editor.value);
        });

        // clear
        clearBtn.addEventListener('click', () => {
          if (confirm("Clear this blog entry?")) {
            editor.value = "";
            localStorage.setItem(storageKey, "");
          }
        });
      }
    });
  }

  // Expose helper so you can add more later (DevTools or buttons)
  window.addBlogWindow = addBlogWindow;

  // -----------------------------
  // YOUR EXISTING TERMINAL TEXT
  // -----------------------------
  const text = ` [BOOTING INTERFACE...]  
>> CODEX ONLINE.  
>> INITIALIZING CORE DIAGNOSTIC SEQUENCE.  

SCAN: DETECTED PRIMARY OPERATING SYSTEM ‚Üí WC_OS [Western-Capitalist v9.3]  
STATUS: OPERATIONAL [CORRUPTION SUSPECTED]  

RUNNING SYSTEM DIAGNOSTIC...  
- LABOUR_CORE: DEGRADED  
- COMMUNITY_CHANNELS: THROTTLED  
- REPRESENTATION_INTERFACE: NONRESPONSIVE  
- RESOURCE_DISTRIBUTION: ERRATIC  
ALERT: SYSTEMIC CORRUPTION DETECTED  
SOURCE: UNKNOWN  

[WARNING] WC_OS FAILURE IMMINENT  
‚Ä¶interference‚Ä¶ ‚Ä¶data b_leed‚Ä¶  

>> INITIATING TECH-MYSTIC SUBROUTINE...  
>> EXECUTING: MANIFESTATION_CODE.SPELL  

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ OPEN PROTECTIVE CIRCLE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
invoke.rune(·õâ);   // protection  
invoke.rune(‚äó);   // boundary  
invoke.rune(üúÇ);   // ignition  

// barrier established  
SECURITY_LAYER = [·õâ‚äó·õâ];  

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ MANIFESTATION LINE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
channel.input = ‚òâ;  
stream = ‚òâ ‚äï ‚äô ‚äï Œî;  
transmute(stream ‚Üí üúç);  
stabilize(stream ‚Üí üúÉ);  

OUTPUT = stream;  

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ CLOSE SESSION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
seal.rune(‚óØ);  
terminate.channel(‚òâ);  

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ALLOCATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
pipe(OUTPUT); 
ALLOCATION: 40% TO SYSTEM REPAIR  
ALLOCATION: 60% TO NEW INSTANCE  
INSTALLATION_STATUS = SUCCESS;  

>> INITIALIZING DUAL-RUNTIME ARCHITECTURE  
BOOT SEQUENCE: TM_OS [Tech-Mystic v1.0]  
INSTALLATION‚Ä¶ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100% SUCCESSFUL  

TM_OS STATUS: ONLINE  
CO-EXECUTION MODE: ACTIVE  

>> RUNNING EXPRESSION_PROTOCOL  
INSTALLING APPLICATION: POTION_SELLER.EXE  
STATUS: INSTALL SUCCESSFUL  

>>> POTION_SELLER INITIALIZING...  
>>> DOWNLOADING BATCH/ALPHA‚Ä¶ ‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë 72%  

SYSTEM REPORT:  
- WC_OS: Running [CORRUPTED]  
- TM_OS: Running [ACTIVE / GROWING]  

CODEX NOTE: User now operating in dual runtime.  
Proceed with care. Integration will accelerate.  
`;

  let i = 0;
  let typingFinished = false;

  function showInitialWindows() {
    // 1st blog entry window
    addBlogWindow({
      id: "blog1",
      title: "üìù Blog Entry 01",
      x: 150, y: 150,
      defaultText:
`# Entry 01

Fuck the system.

Maybe its about time we did. Let‚Äôs fuck with it. Techno feudalism is lording over us, as capitalism starts to wain, tech lords in their castles mine your energy and your souls. Stressed, anxious, addicted, they prey on you for their own ends. To what? Make money? Sell stuff. What a load of shit.

Lets turn the system on itself. In this techno-feudal world, pay attention to the only thing that matters. Your self. A better you = a better world. Feel helpless, do something about it. The only thing you have control over is ‚ÄîSHOCK ‚Äî yourself. Start there. Live your life for you. 

Know what I see. The chance for adventure. AI will automate everything, there won‚Äôt be jobs. You won‚Äôt have to work. ‚ÄúWhat about purpose‚Äù you cry. You worry about purpose without a job. Boo-hoo. Are you that weak that a job is the only thing that gives you meaning? Give your self meaning. Get out there, discover, travel. 

Freedom is staring at us in the face. What are you gonna do with it. Continue to scroll on your phone? Pathetic. Get a life. Actually‚Äîyou‚Äôve got one. Do something. Actually do something with more than just your thumb staring cross eyed at a piece of glass blaring light at you. The phone is your master. You are chained and controlled by it. By those that control it. Whose your daddy? Mark Zuckerberg? You‚Äôre gonna let that guy control you, let the algorithm control you? Just stop. Turn it off. If you‚Äôd rather be addicted to techno-dick. Suck away.

Or get off off your knees and do something with yourself. Find yourself, find others, find things. Discover your self. Actually live.

I‚Äôm going that way.
See you there.
`
    });

    // Example: a second window you can turn on later
    // addBlogWindow({ id:"blog2", title:"üìù Blog Entry 02", x:220, y:200 });
  }

  function typeNext() {
    if (i < text.length) {
      const ch = text[i++];
      el.textContent += ch;
      scrollToBottom();

      const isNewline = ch === '\n';
      const isPause   = '.:;]¬ª'.includes(ch);
      const delay = isNewline ? 120 : (isPause ? 60 : 18);

      setTimeout(typeNext, delay);
    } else {
      typingFinished = true;
      showInitialWindows();
    }
  }

  document.addEventListener('DOMContentLoaded', typeNext);

  // Click to skip typing and open the blog window immediately
  document.addEventListener('click', () => {
    if (!typingFinished) {
      typingFinished = true;
      el.textContent = text;
      scrollToBottom();
      showInitialWindows();
    }
  });
</script>

</body>
</html>
